<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내 이름을 정해줘!</title>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="../static/js/main.js"></script>
    <link rel="stylesheet" href="../static/css/common.css">
    <link rel="stylesheet" href="../static/css/main.css">


</head>
<script>
    $(document).ready(function () {

        $("input[id=ex_input]").keyup(function (event) {

            regexp = /[a-z0-9]|[ \[\]{}()<>?|`~!@#$%^&*-_+=,.;:\"'\\]/g;
            v = $(this).val();
            if (regexp.test(v)) {
                alert("한글만 해줄거야!");
                $(this).val(v.replace(regexp, ''));
            }
        });
    })

    function get_mynick() {
        $.ajax({
                type: "GET",
                url: "/get_mynick",
                data: {},
                success: function (response) {
                    let noun_words = new Array();                                       {# 명사 리스트 생성 #}
                    let adj_words = new Array();                                        {# 형용사 리스트 생성 #}
                    let animal_words = new Array();                                     {# 동물 리스트 생성 #}
                    let fruits_words = new Array();                                     {# 과일 리스트 생성 #}
                    let animal_fruits_words = new Array();                              {# 동물+과일 리스트 생성 #}

                    let adj_count = 0                                                   {# 형용사 개수 카운트 #}
                    let noun_count = 0                                                  {# 명사 개수 카운트 #}
                    let animal_count = 0                                                {# 동물 개수 카운트 #}
                    let fruits_count = 0                                                {# 과일 개수 카운트 #}


                    let nickname = response['all_nickname']


                    for (let i = 0; i < nickname.length; i++) {

                        let words = nickname[i]['word']
                        let type = nickname[i]['class']

                        if (type == 'adj') {                                            {# adj_words list에 형용사 저장 #}
                            adj_count += 1
                            adj_words[adj_count] = words;
                        } else if (type == 'noun') {                                    {# noun_words list에 명사 저장 #}
                            noun_count += 1
                            noun_words[noun_count] = words;
                        } else if (type == 'animal') {
                            animal_count += 1
                            animal_words[animal_count] = words;                         {# animal_words list에 동물 저장 #}
                            animal_fruits_words[animal_count] = words;                  {# animal_fruits_words list에 동물 저장 #}
                        } else {
                            fruits_count += 1
                            fruits_words[fruits_count] = words;                         {# fruits_words list에 과일 저장 #}
                            animal_fruits_words[fruits_count + animal_count] = words;   {# animal_fruits_words list에 과일 저장 #}
                        }
                    }

                    let target = $('.on').html()
                    let word_counting = $('.count').val()
                    let animal_check = $('.animal input').hasClass('on')
                    let fruits_check = $('.fruits input').hasClass('on')

                    if (target == '형용사') {                                                           {# 형용사 옵션 선택 #}
                        let wish_adj = $('#ex_input').val()                                            {# 원하는 형용사를 받아옴 #}
                        if (animal_check != true) {
                            if (fruits_check != true) {
                                if (wish_adj != '') {                                                  {# 과일 Flase, 동물 False, 형용사가 빈칸이 아니면 #}
                                    let ran_noun_num = Math.floor(Math.random() * 25416 + 1);          {# 25416 까지의 난수 생성 (명사 개수) #}
                                    let adj_len1 = wish_adj.length                                     {# 희망하는 형용사의 글자 수 #}
                                    let noun_len1 = noun_words[ran_noun_num].length                    {# 랜덤 명사의 글자 수 #}
                                    if (adj_len1 + noun_len1 <= word_counting) {                       {# 형용사+명사 글자수가 최대글자수 보다 작거나 같으면 출력 #}
                                        console.log(adj_len1, noun_len1, adj_len1 + noun_len1)
                                        console.log(wish_adj, noun_words[ran_noun_num])
                                        let ResultName = wish_adj+' ' +noun_words[ran_noun_num];
                                
                                        $('.NameResult').text(ResultName);
                                        $('#GetPage').css('display','none');
                                        $('#ResultPage').css('display','flex');
                                    }

                                } else {
                                    alert('형용사를 입력해줘!')
                                }
                            } else {
                                if (wish_adj != '') {                                                  {# 과일 True, 동물 False, 형용사가 빈칸이 아니면 #}
                                    let ran_fruits_num = Math.floor(Math.random() * 51 + 1);           {# 51 까지의 난수 생성 (과일 개수) #}
                                    let adj_len2 = wish_adj.length                                     {# 희망하는 형용사의 글자 수 #}
                                    let fruits_len2 = fruits_words[ran_fruits_num].length              {# 랜덤 과일의 글자 수 #}
                                    if (adj_len2 + fruits_len2 <= word_counting) {                     {# 형용사+과일 글자수가 최대글자수 보다 작거나 같으면 출력 #}
                                        console.log(adj_len2, fruits_len2, adj_len2 + fruits_len2)
                                        console.log(wish_adj, fruits_words[ran_fruits_num])
                                        console.log(ran_fruits_num, adj_len2, fruits_len2, fruits_words[ran_fruits_num])
                                        let ResultName = wish_adj+' ' +fruits_words[ran_fruits_num];
                                
                                        $('.NameResult').text(ResultName);
                                        $('#GetPage').css('display','none');
                                        $('#ResultPage').css('display','flex');
                                    }
                                } else {
                                    alert('형용사를 입력해줘!')
                                }
                            }
                            
                        } else {
                            if (fruits_check != true) {
                                if (wish_adj != '') {                                                  {# 과일 False, 동물 True, 형용사가 빈칸이 아니면 #}
                                    let ran_animal_num = Math.floor(Math.random() * 141 + 1);          {# 141 까지의 난수 생성 (동물 개수) #}
                                    let adj_len3 = wish_adj.length                                     {# 희망하는 형용사의 글자 수 #}
                                    let animal_len3 = animal_words[ran_animal_num].length              {# 랜덤 동물의 글자 수 #}
                                    if (adj_len3 + animal_len3 <= word_counting) {                     {# 형용사+동물 글자수가 최대글자수 보다 작거나 같으면 출력 #}
                                        console.log(adj_len3, animal_len3, adj_len3 + animal_len3)
                                        console.log(wish_adj, animal_words[ran_animal_num])
                                        console.log(ran_animal_num, adj_len3, animal_len3, animal_words[ran_animal_num])
                                        let ResultName = wish_adj+' ' +animal_words[ran_animal_num];
                                
                                        $('.NameResult').text(ResultName);
                                        $('#GetPage').css('display','none');
                                        $('#ResultPage').css('display','flex');
                                    }
                                } else {
                                    alert('형용사를 입력해줘!')
                                }
                            } else {
                                if (wish_adj != '') {                                                  {# 과일 True, 동물 True, 형용사가 빈칸이 아니면 #}
                                    let ran_ani_fru_num = Math.floor(Math.random() * 192 + 1);         {# 192 까지의 난수 생성 ((동물+과일) 개수) #}
                                    let adj_len4 = wish_adj.length                                     {# 희망하는 형용사의 글자 수 #}
                                    let ani_fru_len4 = animal_fruits_words[ran_ani_fru_num].length     {# 랜덤 (동물+과일)의 글자 수 #}
                                    if (adj_len4 + ani_fru_len4 <= word_counting) {                    {# 형용사+(동물+과일) 글자수가 최대글자수 보다 작거나 같으면 출력 #}
                                        console.log(adj_len4, ani_fru_len4, adj_len4 + ani_fru_len4)
                                        console.log(wish_adj, animal_fruits_words[ran_ani_fru_num])
                                        console.log(ran_ani_fru_num, adj_len4, ani_fru_len4, animal_fruits_words[ran_ani_fru_num])
                                        let ResultName = wish_adj+' ' +animal_fruits_words[ran_ani_fru_num];
                                
                                        $('.NameResult').text(ResultName);
                                        $('#GetPage').css('display','none');
                                        $('#ResultPage').css('display','flex');
                                    }
                                } else {
                                    alert('형용사를 입력해줘!')
                                }
                            }


                        }

                    } else if (target == '명사') {                                                      {# 명사 옵션 선택 #}
                        let wish_noun = $('#ex_input').val()                                           {# 원하는 명사를 받아옴 #}
                        if (wish_noun != '') {                                                         {# 명사가 빈칸이 아니면 #}
                        let ran_adj_num = Math.floor(Math.random() * 181 + 1);                         {# 181 까지의 난수 생성 (형용사 개수) #}
                        let adj_len5 = adj_words[ran_adj_num].length                                   {# 랜덤 형용사의 글자 수 #}
                        let noun_len5 = wish_noun.length                                               {# 희망하는 명사의 글자 수 #}
                        if (adj_len5 + noun_len5 <= word_counting) {                                   {# 형용사+명사 글자수가 최대글자수 보다 작거나 같으면 출력 #}
                            console.log(adj_len5, noun_len5, adj_len5 + noun_len5)
                            console.log(adj_words[ran_adj_num], wish_noun);
                            let ResultName = adj_words[ran_adj_num]+' ' +wish_noun;
                                
                                $('.NameResult').text(ResultName);
                                $('#GetPage').css('display','none');
                                $('#ResultPage').css('display','flex');
                        }
                        } else {
                            alert('명사를 입력해줘!')
                        }
                    } else {                                                                           {# 완전랜덤 옵션 선택 #}
                        let ran_adj_num = Math.floor(Math.random() * 181 + 1);                         {# 181 까지의 난수 생성 (형용사 개수) #}
                        let ran_noun_num = Math.floor(Math.random() * 25416 + 1);                      {# 25416 까지의 난수 생성 (명사 개수) #}
                        let adj_len6 = adj_words[ran_adj_num].length                                   {# 랜덤 형용사의 글자 수 #}
                        let noun_len6 = noun_words[ran_noun_num].length                                {# 랜덤 명사의 글자 수 #}
                        if (adj_len6 + noun_len6 <= word_counting) {                                   {# 형용사+명사 글자수가 최대글자수 보다 작거나 같으면 출력 #}
                            console.log(adj_len6, noun_len6, adj_len6 + noun_len6)
                            console.log(adj_words[ran_adj_num], noun_words[ran_noun_num]);
                            let ResultName = adj_words[ran_adj_num] +' ' + noun_words[ran_noun_num];
                            console.log(adj_words[ran_adj_num], noun_words[ran_noun_num]);
                            $('.NameResult').text(ResultName);
                            $('#GetPage').css('display','none');
                            $('#ResultPage').css('display','flex');
                        }
                        $('.saveAlert').text($('.NameResult').text());
                        
                    }
                }


            }
        )
    }

</script>
<body>
    {% if not token %}

    {% endif %}

    <header>
        <a href="/myPage">마이페이지</a>
    </header>
    <article id="GetPage">
        <section id="character">
            <p class="myName">내 이름을 정해줘!</p>
            <img src="../static/img/CHAR.svg" alt="character image">
        </section>
        <section id="option">
            <div class="assignWord">
                <p>고정단어</p>
                <section>
                    <div class="textInput">
                        <label for="ex_input">형용사를 원해!</label>
                        <input type="text" id="ex_input">
                        <button class="textClear"></button>
                    </div>
                    <div class="wordOption">
                        <p class="on">형용사</p>
                        <span></span>
                        <p class="off">명사</p>
                        <span></span>
                        <p class="off">완전랜덤</p>
                    </div>
                </section>
            </div>
            <div class="maxWord">
                <p>최대글자수</p>
                <section>
                    <form oninput="count.value = parseInt(RangeInput.value)">
                        <input type="range" min="3" max="13" step="" value="9" name="RangeInput">
                        <div>
                            <output name='count' for="RangeInput" class="count">9</output>
                            <p>자</p>
                        </div>
                    </form>
                </section>
            </div>
            <div class='nounOption'>
                <p>명사종류</p>
                <section>
                    <div>
                        <label class="fruits checks">
                            <p>과일</p>
                            <input type="checkbox">
                            <span class="checkmark"></span>
                        </label>
                    </div>
                    <div>
                        <label class="animal checks">
                            <p>동물</p>
                            <input type="checkbox">
                            <span class="checkmark"></span>
                        </label>
                    </div>
                </section>
            </div>
        </section>
        <button onclick="get_mynick()" id="enter">ENTER</button>
    </article>

    <article id="ResultPage">
        <section id="saveName">
            <div id="box">
                <button class="close"></button>
                <div>
                <p>마이페이지에 '<span class="saveAlert"></span>' 를 저장했다!</p>
            </div>
            </div>
    </section>

        <article>
            <section id="ResultContent">
                <p class="NameResult">무시무시한 감자</p>
                <img src="../static/img/CHAR.svg" alt="character image">

                <div class="textBox">
                    <p>이 이름이 마음에 드니?</p>

                    <div>
                    <ul>
                        <li class="off saveToMyPage"> <span>></span> 응, 저장할래! </li>
                        <li class="off Clip"> <span>></span> 응, 바로 복사할래! </li>
                        <li class="off Reset"> <span>></span> 아니, 처음부터 다시할래! </li>
                        <li class="off Retry" onclick="get_mynick ()"> <span>></span> 아니, 같은 설정으로 다시 정해줘! </li>
                    </ul>
                </div>
                </div>
            </section>
        </article>
    </article>
<p id="TempName"></p>
</body>

</html>
